name: 'CodeQL Generic Action'
description: 'A composite action to perform CodeQL analysis'

inputs:
  protected_branches:
    description: 'Protected branches to trigger on'
    required: true
    type: string
  language:
    description: 'Programming language to analyze'
    required: true
    type: string
  build-mode:
    description: 'Build mode for the analysis'
    required: true
    type: string
  build-graddle:
    description: 'Build command for Gradle (if applicable)'
    required: false
    type: string
  build-maven:
    description: 'Build command for Maven (if applicable)'
    required: false
    type: string
  build-csharp:
    description: 'Build command for C# (if applicable)'
    required: false
    type: string

runs:
  using: 'composite'
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: ${{ inputs.language }}
        build-mode: ${{ inputs.build-mode }}

    - name: Build for Java
      if: ${{ inputs.build-mode == 'manual' && inputs.language == 'java' }}
      run: |
        if [ -n "${{ inputs.build-graddle }}" ]; then
          ${{ inputs.build-graddle }}
        fi
        if [ -n "${{ inputs.build-maven }}" ]; then
          ${{ inputs.build-maven }}
        fi

    - name: Build for C#
      if: ${{ inputs.build-mode == 'manual' && inputs.language == 'csharp' }}
      run: |
        if [ -n "${{ inputs.build-csharp }}" ]; then
          ${{ inputs.build-csharp }}
        fi

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
      with:
        category: "/language:${{ inputs.language }}"
